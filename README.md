# Digital Signature System

A simple, single-page application for digitally signing documents. It fetches data from a Google Apps Script, allows users to sign using a canvas element, and saves the signed document as a PDF to Google Drive. This system is designed for scenarios where a list of individuals need to sign a standardized document, and the process needs to be tracked and managed digitally.

## Features

-   **Data Fetching:** Retrieves a list of documents to be signed from a Google Apps Script connected to a Google Sheet.
-   **Date Filtering:** Allows users to filter and view documents for a specific day, making it easy to manage daily signing tasks.
-   **Document Preview:** Before signing, users can preview the document with their specific data populated.
-   **Signature Pad:** Provides a responsive canvas element for users to draw their digital signature.
-   **PDF Generation:** Dynamically generates a PDF document of the signed agreement using a Google Docs template.
-   **Google Drive Integration:** Saves the final signed PDF to a specified folder in Google Drive.
-   **Status Tracking:** Updates the Google Sheet with the status of the signature ("firmado") and a link to the generated PDF.

## How it Works

1.  **Data Fetching:** When the `index.html` page is loaded, a JavaScript function sends a `GET` request to the deployed Google Apps Script. The `doGet` function in `code.gs` reads the data from the Google Sheet and returns it in JSON format.
2.  **Displaying Data:** The web application parses the JSON data and displays it in a table. Users can filter the records by date to see who needs to sign on a particular day.
3.  **Signing Process:** When a user clicks the "Sign" button, a modal window appears.
    -   A preview of the document is generated by the Apps Script and displayed to the user.
    -   The user can then draw their signature on a canvas element.
4.  **PDF Generation and Saving:** Upon saving the signature, the JavaScript code captures the signature as a Base64 encoded image. It then sends a `POST` request to the Apps Script with the user's data and the signature image.
5.  **Google Drive Integration:** The `doPost` function in `code.gs` creates a copy of the Google Docs template, replaces the placeholders with the user's information, inserts the signature image, and converts the document to a PDF.
6.  **Updating the Sheet:** The generated PDF is saved to a "Documentos Firmados" folder in Google Drive, and the Google Sheet is updated with the "firmado" status and a link to the PDF file for the corresponding entry.

## Technologies Used

-   **Frontend:**
    -   HTML
    -   CSS
    -   JavaScript
-   **Backend (Google Workspace):**
    -   Google Apps Script
    -   Google Sheets (as a database)
    -   Google Docs (as a template)
    -   Google Drive (for PDF storage)

## Setup

Follow these steps to configure and deploy the application:

### 1. Set Up the Google Sheet

1.  Create a new **Google Sheet** in your Google Drive.
2.  Rename the sheet to a name of your choice (e.g., "Signatures"). This name will be used in the `code.gs` configuration.
3.  Set up the following columns in the first row:
    | Column A | Column B | Column C | Column D | Column E | Column F |
    | :--- | :--- | :--- | :--- | :--- | :--- |
    | `date` | `shift` | `firstName` | `lastName` | `status` | `fileUrl` |

    -   `date`: The date of the signature (e.g., `DD/MM/YYYY`).
    -   `shift`: The work shift (e.g., "Morning", "Afternoon").
    -   `firstName`: The first name of the person signing.
    -   `lastName`: The last name of the person signing.
    -   `status`: The status of the signature ("pending" or "firmado").
    -   `fileUrl`: The URL of the saved PDF (will be filled automatically by the script).

### 2. Create the Google Docs Template

1.  Create a new **Google Doc** to be used as a template for the PDF.
2.  Add the content you want to appear in the final PDF, using placeholders for dynamic data. The available placeholders are:
    -   `{{FECHA}}`: The date from the Google Sheet.
    -   `{{TURNO}}`: The shift from the Google Sheet.
    -   `{{NOMBRE_COMPLETO}}`: The full name of the person signing.
    -   `{{FECHA_COMPLETA}}`: The full date when the document is signed (e.g., "16 de octubre de 2025").
    -   `{{FIRMA}}`: The placeholder for the signature image. This will be replaced with the user's signature.

### 3. Configure the Google Apps Script (`code.gs`)

1.  Open your Google Sheet and go to **Extensions > Apps Script**.
2.  Copy the content of the `code.gs` file from this repository and paste it into the script editor.
3.  Update the configuration constants at the top of the `code.gs` file:
    -   `SHEET_ID`: The ID of your Google Sheet (from the URL).
    -   `SHEET_NAME`: The name of the sheet you created (e.g., "Signatures").
    -   `TEMPLATE_DOC_ID`: The ID of your Google Docs template (from the URL).

### 4. Deploy the Google Apps Script

1.  In the Apps Script editor, click **Deploy > New deployment**.
2.  Select **Web app** as the deployment type.
3.  Configure the web app with the following settings:
    -   **Execute as:** `Me`
    -   **Who has access:** `Anyone with Google account` (or `Anyone` if you want it to be public).
4.  Click **Deploy**.
5.  **Authorize** the script to access your Google account.
6.  Copy the **Web app URL** provided after deployment.

### 5. Configure the `index.html` File

1.  Open the `index.html` file.
2.  Find the `CONFIG` object in the `<script>` section.
3.  Replace the placeholder URL with the **Web app URL** you copied in the previous step:
    ```javascript
    const CONFIG = {
        scriptUrl: 'YOUR_GOOGLE_APPS_SCRIPT_URL'
    };
    ```

### 6. Using the Application

1.  Open the `index.html` file in your web browser.
2.  The application will fetch the data from your Google Sheet.
3.  Users can sign the documents, and the signed PDFs will be saved to a "Documentos Firmados" folder in your Google Drive.

## Backend Logic (`code.gs`)

The `code.gs` script handles all the backend operations. It has two main functions: `doGet` and `doPost`.

-   `doGet(e)`: This function is triggered by `GET` requests. It handles two actions:
    -   `getData`: Retrieves all the data from the specified Google Sheet.
    -   `generatePreview`: Creates a temporary Google Doc from the template, fills it with the user's data, and returns a public URL for previewing.
-   `doPost(e)`: This function is triggered by `POST` requests. It handles the `savePDF` action:
    -   It takes the user's data and the Base64 encoded signature.
    -   It calls `createPDFFromTemplate` to generate the PDF.
    -   It saves the PDF to Google Drive.
    -   It updates the Google Sheet with the "firmado" status and the PDF URL.

## Frontend Logic (`index.html`)

The `index.html` file contains the user interface and the client-side logic.

-   **UI:** The UI is built with HTML and styled with CSS. It includes a table to display the data, a date filter, and a modal for signing.
-   **JavaScript:**
    -   `loadAllData()`: Fetches the data from the Apps Script when the page loads.
    -   `renderTable()`: Renders the fetched data in the HTML table.
    -   `openSignModal()`: Opens the signature modal and initializes the canvas.
    -   `loadDocumentPreview()`: Fetches and displays the document preview.
    -   `saveSignature()`: Captures the signature, sends the data to the Apps Script, and handles the response.
    -   **Canvas Logic:** The script includes functions to handle drawing on the canvas (`startDrawing`, `draw`, `stopDrawing`).

## Troubleshooting

-   **"Error al cargar datos" (Error loading data):**
    -   Check that the `scriptUrl` in `index.html` is correct.
    -   Make sure you have deployed the Apps Script and granted the necessary permissions.
    -   Verify that the Google Sheet and Google Docs template are accessible.
-   **"Acción no válida" (Invalid action):** This error usually indicates a problem with the URL parameters in the `fetch` requests. Check the `action` parameter in the JavaScript code.
-   **PDF not saving to Drive:**
    -   Ensure the Apps Script has permission to access your Google Drive.
    -   Check the `SHEET_ID` and `TEMPLATE_DOC_ID` in `code.gs`.

## Contributing

Contributions are welcome! If you have any ideas, suggestions, or bug reports, please open an issue or submit a pull request.

## License

This project is licensed under the MIT License. See the `LICENSE` file for details.